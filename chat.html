<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat</title>
  <link rel="stylesheet" href="./css/chat.css" />
  <link rel="icon" type="image/png" href="./images/favicon.ico"/> 
</head>
<body>
<!-- GIF container -->
<div id="locked">
        <img src="./gifs/67-67-kid.gif">
    <img src="./gifs/67.gif">
    <img src="./gifs/anime-manga.gif">
    <img src="./gifs/chill.gif">
    <img src="./gifs/cute.gif">
    <img src="./gifs/kis.gif">
    <img src="./gifs/shrek.gif">
    <img src="./gifs/what.gif">
    <!-- Right-side GIFs -->
    <img src="./gifs/rightGifs/bosnov-67.gif">
    <img src="./gifs/rightGifs/emoji.gif">
    <img src="./gifs/rightGifs/enojado.gif">
    <img src="./gifs/rightGifs/oh-no-oh-my-god.gif">
    <img src="./gifs/rightGifs/patrick-bateman-smile.gif">
    <img src="./gifs/rightGifs/reallycooked.gif">
    <img src="./gifs/rightGifs/sigmasungjinwoo-mewing.gif">
    <img src="./gifs/rightGifs/solo-leveling-sololeveling.gif">
    <img src="./gifs/rightGifs/thofinn.gif">
    <img src="./gifs/rightGifs/thorfinn.gif">
    <img src="./gifs/rightGifs/twitch-twitch-emote.gif">
    <img src="./gifs/rightGifs/what-twitch.gif">
    <!-- Ethan Gifs -->
    <img src="./gifs/ethan/1.gif">
    <img src="./gifs/ethan/2.gif">
    <img src="./gifs/ethan/3.gif">
    <img src="./gifs/ethan/4.gif">
    <img src="./gifs/ethan/5.gif">
    <img src="./gifs/ethan/6.gif">
    <img src="./gifs/ethan/7.gif">
    <img src="./gifs/ethan/8.gif">
    <img src="./gifs/ethan/9.gif">
    <img src="./gifs/ethan/10.gif">
    <img src="./gifs/ethan/11.gif">
    <img src="./gifs/ethan/12.gif">
    <img src="./gifs/ethan/13.gif">
    <img src="./gifs/ethan/14.gif">
    <img src="./gifs/ethan/15.gif">
</div>
<div class="main">

<div class="sideBar">
    <img src="./images/clearLogo.png" style="width: 100%;">
        <div id="signedInAs" class="GroupNormalMargin TextSizeXLarge"></div>
        <button class="SBbtns">Show Users Status</button>
        <button class="SBbtns" id="adminPanelBtn">Hide Admin Panel</button>
        <button class="SBbtns" id="signoutbtn" onclick="window.location.href='./index.html'">Sign Out</button>
    <p style="font-size:12px; color:#aaa;">&copy; 2024 Lucky Pals. All rights reserved.</p>
</div>




<div class="MainArea"> 
    <div id="messages" class="GroupNormalMargin">
      <p>Loading messages...</p>
    </div>


<div class="inputBar">
    <form id="msgForm">
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="msgInput" type="text" placeholder="Type a message" autocomplete="off" style="flex: 1;" autocapitalize="off" spellcheck="false" />

        <input type="submit" value="Send" class="upload-label smBtn"/>

        <button type="button" class="upload-label smBtn" id="gifBtn">GIFs</button>


         <div id="uploadSection" style="display:none;"> 
        <label for="imageUpload" class="upload-label">Choose Image</label>
        <button id="sendImageBtn" class="upload-label smBtn">Send File</button>
        <input type="file" id="imageUpload" accept="image/*" />
        </div>
      </div>
    </form>

    <div class="MainActionContainer">
    <div id="uploadSection" style="display:none; margin-bottom:10px;">
    <div id="imagePreview" style="margin-top:6px;"></div>
    </div>
</div>
</div>
</div>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<!-- Main Script -->
<script>

/* -------------------- CONFIG -------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyBGPFSP0e0oYqKqvJHLB5eGlX9mJ8aU09s",
  authDomain: "test-da143.firebaseapp.com",
  databaseURL: "https://test-da143-default-rtdb.firebaseio.com",
  projectId: "test-da143",
  storageBucket: "test-da143.firebasestorage.app",
  messagingSenderId: "58366480447",
  appId: "1:58366480447:web:f3dd12850f09952b49688a",
  measurementId: "G-T5HK7JTWHW"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* -------------------- USERS -------------------- */
const idToName = { 
  "596923":"Muzafar",
  "564380":"Harshan",
  "603974":"Dasani",
  "545208":"Braylen",
  "547025":"Jostin",
  "600437":"Blake",
  "599328":"Ethan",
  "589475":"Liam",
  "598292":"Jacob" 
};
const users = {
  "596923": { name: "Muzafar", role: "Admin" },
  "547025": { name: "Jostin", role: "PremiumOG" },
  "599328": { name: "Ethan", role: "PremiumOG" },
  "564380": { name: "Harshan" },
  "603974": { name: "Dasani" },
  "545208": { name: "Braylen" },
  "600437": { name: "Blake" },
  "589475": { name: "Liam", role: "PremiumOG" },
  "598292": { name: "Jacob" }
};
const adminUsers = ["596923"];
const shortCooldownUsers = ["596923","547025","599328","589475"];

/* -------------------- CURRENT USER -------------------- */
const currentUserId = localStorage.getItem('username') || sessionStorage.getItem('username');

if (!currentUserId) { alert("No username found."); window.location.href = './index.html'; }
const currentUser = users[currentUserId];
if (!currentUser || currentUser.role !== "Admin") {
  const mainArea = document.querySelector(".MainArea");
  if (mainArea) {mainArea.style.width="78vw"; }
}
// -------------------- INSTANT BAN LISTENER --------------------
if (currentUserId) {
    db.ref(`bans/${currentUserId}`).on("value", snap => {
        const banData = snap.val();
        if (banData && banData.expires > Date.now()) {
            alert(`‚õî You have been banned until ${new Date(banData.expires).toLocaleString()}`);
            window.location.href = "./index.html";
        } else if (banData && banData.expires <= Date.now()) {
            db.ref(`bans/${currentUserId}`).remove();
        }
    });
}
// -------------------- Instant ban check done --------------------
document.getElementById('signedInAs').textContent = 'Signed in as: ' + (idToName[currentUserId]||currentUserId);

/* -------------------- HELPERS -------------------- */
function escapeHtml(s){if(!s&&s!==0)return'';return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

/* -------------------- ADMIN PANEL -------------------- */
function createAdminPanel() {
  if(!adminUsers.includes(currentUserId)||document.getElementById("adminPanel"))return;
  const style = document.createElement("style");
  style.textContent = `#adminPanel{position:fixed;top:8px;right:20px;background-color:#414040;border-radius:10px;padding:14px 18px;width:320px;height:85vh;text-align:center;z-index:999;animation:fadeIn 0.3s ease;}#adminPanel h3{font-size:16px;margin-bottom:10px;}#adminPanel button{margin-top:5px;padding:4px 8px;cursor:pointer; background-color: #00bf63; border:none; color:white; padding:5px 10px; border-radius:4px;}#adminPanel input{width:80%;margin:4px 0;padding:3px;}#bannedList{max-height:150px;overflow-y:auto;text-align:left;margin-top:8px;}@keyframes fadeIn{from{opacity:0;transform:translateY(-55%);}to{opacity:1;transform:translateY(-50%);}}`;
  document.head.appendChild(style);
  const panel = document.createElement("div");
  panel.id="adminPanel";
  panel.innerHTML=`
    <h3>Admin Panel</h3>
    <button id="clearMessagesBtn">Clear All Messages</button>
    <p id="adminStatus">Logged in as admin: ${currentUserId}</p>
    <hr>
    <h4>Ban User</h4>
    <input type="text" id="banUsername" placeholder="Enter username or ID" />
    <input type="number" id="banDuration" placeholder="Minutes" min="1"/>
    <button id="banBtn">Ban User</button>
    <p id="banInfo" style="font-size:12px;color:#aaa;margin-top:4px;"></p>
    <hr>
    <h4>Currently Banned Users</h4>
    <div id="bannedList"><p>Loading...</p></div>`;
  document.body.appendChild(panel);
  document.getElementById("clearMessagesBtn").addEventListener("click",()=>{if(confirm("‚ö†Ô∏è Are you sure you want to delete ALL messages?")) db.ref("messages").remove().catch(err=>alert("‚ùå Error: "+err.message));});
  document.getElementById("banBtn").addEventListener("click",()=>{const usernameOrId=document.getElementById("banUsername").value.trim();const durationMinutes=parseInt(document.getElementById("banDuration").value);if(!usernameOrId||isNaN(durationMinutes)||durationMinutes<1){alert("‚ùå Please enter a valid username/ID and duration.");return;}let userId=Object.keys(idToName).find(id=>idToName[id]===usernameOrId)||usernameOrId;const banExpires=Date.now()+durationMinutes*60*1000;db.ref(`bans/${userId}`).set({expires:banExpires}).then(()=>{const expiresDate=new Date(banExpires).toLocaleString();alert(`‚úÖ ${usernameOrId} is banned until ${expiresDate}`);document.getElementById("banInfo").textContent=`${usernameOrId} banned until ${expiresDate}`;}).catch(err=>alert("‚ùå Error: "+err.message));});
  function updateBannedList(){const listDiv=document.getElementById("bannedList");db.ref("bans").once("value").then(snap=>{const bans=snap.val()||{};listDiv.innerHTML="";Object.keys(bans).forEach(userId=>{const ban=bans[userId];if(ban.expires&&ban.expires>Date.now()){const displayName=idToName[userId]||userId;const div=document.createElement("div");div.style.display="flex";div.style.justifyContent="space-between";div.style.alignItems="center";div.style.marginBottom="4px";const text=document.createElement("span");text.textContent=`${displayName} (expires: ${new Date(ban.expires).toLocaleString()})`;const unbanBtn=document.createElement("button");unbanBtn.textContent="Unban";unbanBtn.addEventListener("click",()=>db.ref(`bans/${userId}`).remove().then(updateBannedList));div.appendChild(text);div.appendChild(unbanBtn);listDiv.appendChild(div);}});if(listDiv.innerHTML==="")listDiv.innerHTML="<p>No active bans.</p>";});}
  db.ref("bans").on("value",updateBannedList);updateBannedList();
}
/* -------------------- TOGGLE ADMIN PANEL BUTTON -------------------- */
document.addEventListener("DOMContentLoaded", () => {
    
  const adminBtn = document.querySelectorAll(".SBbtns")[1]; // 2nd button
 const adminBtn2 = document.getElementById("adminPanelBtn");
  if (!adminUsers.includes(currentUserId) && adminBtn) {
    adminBtn.style.display = "none";
  }
  adminBtn.addEventListener("click", () => {
    const panel = document.getElementById("adminPanel");

    if (panel) {
      // Toggle visibility if already created
      const isVisible = panel.style.display !== "none";
      panel.style.display = isVisible ? "none" : "block";
      adminBtn.textContent = isVisible ? "Show Admin Panel" : "Hide Admin Panel";
    } else {
      // Create it first time only
      createAdminPanel();
      adminBtn.textContent = "Hide Admin Panel";
    }
  });
});
/* -------------------- ONLINE USERS PANEL -------------------- */

const PING_INTERVAL = 1000,
      STALE_TIMEOUT = 10000,
      OFFLINE_TIMEOUT = 15000;

const userRef = db.ref("presence/" + currentUserId);
const usersRef = db.ref("users");
const bansRef = db.ref("bans");

let usersData = {}, bansData = {};

usersRef.on("value", snap => { usersData = snap.val() || {}; });
bansRef.on("value", snap => { bansData = snap.val() || {}; });

const tabId = Math.random().toString(36).substr(2, 9);
const tabRef = userRef.child("tabs").child(tabId);

function updateTabStatus() {
  tabRef.set({ visible: !document.hidden, lastActive: Date.now() });
}
window.addEventListener("beforeunload", () => { tabRef.remove(); });
setInterval(updateTabStatus, PING_INTERVAL);
document.addEventListener("visibilitychange", updateTabStatus);
updateTabStatus();

function createOnlinePanel() {
  // Only create if not already made
  if (document.getElementById("onlinePanel")) return;

  const panel = document.createElement("div");
  panel.id = "onlinePanel";
  panel.innerHTML = "<ul id='userList'></ul>";
  panel.style = `
    width: 100%;
    border: 1px solid #ccc;
    padding: 10px;
    font-size: 12px;
    color: white;
    background-color: rgba(65, 64, 64, 0.8);
    border-radius: 5px;
    overflow-y: auto;
    box-sizing: border-box;
    margin-top: 10px;
    display: none;
    text-align: left;
    
  `;

  const sidebar = document.querySelector('.sideBar');
  sidebar.insertBefore(panel, sidebar.querySelector('p'));

  const userList = panel.querySelector("#userList");

  db.ref("presence").on("value", snap => {
    const data = snap.val() || {};
    const now = Date.now();
    userList.innerHTML = "";

    Object.keys(data).forEach(id => {
      const user = data[id];
      const tabs = Object.values(user.tabs || {});
      const userInfo = usersData?.[id] || {};
      let color = "üî¥";
      const name = idToName?.[id] || userInfo.name || id;

      if (bansData[id] && bansData[id].expires > now) {
        color = "üü£";
      } else {
        const activeTabs = tabs.filter(t => now - t.lastActive < STALE_TIMEOUT);
        if (activeTabs.length > 0) {
          color = activeTabs.some(t => t.visible) ? "üü¢" : "üü°";
        } else {
          color = "üî¥";
        }
      }

      const li = document.createElement("li");
      li.innerHTML = id === currentUserId
        ? `<strong>${color} ${name} (You)</strong>`
        : `${color} ${name}`;
      userList.appendChild(li);
    });
  });
}

/* -------------------- TOGGLE ON BUTTON CLICK -------------------- */
document.addEventListener("DOMContentLoaded", () => {
  createOnlinePanel();
  const panel = document.getElementById("onlinePanel");
  const button = document.querySelector(".sideBar button");

  button.addEventListener("click", () => {
    panel.style.display = panel.style.display === "none" ? "block" : "none";
    button.textContent = panel.style.display === "block" ? "Hide Users Status" : "Show Users Status";
  });
});

/* -------------------- MESSAGES WITH REPLIES -------------------- */
const messagesDiv=document.getElementById('messages');let replyingTo=null;
function renderMessages(data){const val=data||{};messagesDiv.innerHTML='';const entries=Object.entries(val).sort((a,b)=>a[1].timestamp-b[1].timestamp);if(entries.length===0){messagesDiv.innerHTML='<p>No messages yet.</p>';return;}for(const[key,msg]of entries){const shownName=idToName[msg.username]||msg.username;const userInfo=users[msg.username]||{};let roleTag="";if(userInfo.role==="Admin")roleTag=`<span style="background:linear-gradient(90deg, red, blue); color:white; padding:2px 6px; border-radius:6px; font-size:11px; margin-right:6px;">Admin</span>`;else if(userInfo.role==="PremiumOG")roleTag=`<span style="background:linear-gradient(90deg, #b026ff, #6f00ff); color:white; padding:2px 6px; border-radius:6px; font-size:11px; margin-right:6px;">PremiumOG</span>`;let div=document.createElement('div');div.className='entry';div.style.marginBottom="10px";div.dataset.msgId=key;let replyHTML="";if(msg.replyTo&&val[msg.replyTo]){const repliedMsg=val[msg.replyTo];const repliedName=idToName[repliedMsg.username]||repliedMsg.username;replyHTML=`<div style="border-left: 3px solid gray; padding-left: 6px; font-size:10px; color:#bbb; margin-bottom:4px;">Replied to <strong>${escapeHtml(repliedName)}</strong>: <em>${escapeHtml(repliedMsg.text||"[GIF]")}</em></div>`;}
const content=msg.gifUrl?`${roleTag}<strong>${escapeHtml(shownName)}:</strong><br><img src="${escapeHtml(msg.gifUrl)}" alt="gif" style="max-width:100%; border-radius:8px;" /><br><small>${new Date(msg.timestamp).toLocaleString()}</small>`:`${roleTag}<strong>${escapeHtml(shownName)}:</strong> ${escapeHtml(msg.text)}<br><small>${new Date(msg.timestamp).toLocaleString()}</small>`;div.innerHTML=replyHTML+content;const replyBtn=document.createElement("button");replyBtn.textContent="‚Üª";replyBtn.style="margin-top:3px; margin-left: 1vw; font-size:10px; cursor:pointer; opacity:0.7; border-radius:40px; border:none; color:white; background-color:transparent;";replyBtn.addEventListener("click",()=>setReplyTarget(key,shownName,msg.text));div.appendChild(replyBtn);messagesDiv.appendChild(div);}
messagesDiv.scrollTop=messagesDiv.scrollHeight;}
function setReplyTarget(messageId,name,text){replyingTo=messageId;const preview=document.getElementById("replyPreview");preview.innerHTML=`Replying to <strong>${escapeHtml(name)}</strong>: <em>${escapeHtml(text||"[GIF]")}</em> <button id="cancelReply" style="margin-left:10px; cursor:pointer; font-size:10px; border-radius:40px; border:none; color:white; background-color:transparent;">x</button>`;preview.style.display="block";document.getElementById("cancelReply").onclick=()=>{replyingTo=null;preview.style.display="none";};}
const replyPreview=document.createElement("div");replyPreview.id="replyPreview";replyPreview.style=`display:none;height: 0px;background:rgba(255,255,255,0.08);padding-bottom:12px;border-radius:6px;margin:8px 0;font-size:10px;`;document.querySelector("form#msgForm").before(replyPreview);

/* --- Send message --- */
let canSend=true;const msgForm=document.getElementById('msgForm');const msgInput=document.getElementById('msgInput');let sendBtn=msgForm.querySelector('button[type="submit"], input[type="submit"]');if(!sendBtn)sendBtn={disabled:false,style:{},setAttribute:()=>{},removeAttribute:()=>{}};
msgForm.addEventListener('submit',e=>{e.preventDefault();const text=msgInput.value.trim();if(!text||!canSend)return;if(text.length>100){alert(`‚ö†Ô∏è Message too long! (${text.length}/100 characters)`);return;}canSend=false;sendBtn.disabled=true;sendBtn.style.opacity="0.5";sendBtn.style.cursor="not-allowed";const newMsg={username:currentUserId,text,timestamp:Date.now()};if(replyingTo)newMsg.replyTo=replyingTo;db.ref('messages').push(newMsg).then(()=>{msgInput.value='';replyingTo=null;replyPreview.style.display="none";setTimeout(()=>{canSend=true;sendBtn.disabled=false;sendBtn.style.opacity="1";sendBtn.style.cursor="pointer";},1500);}).catch(err=>{alert(err.message);canSend=true;sendBtn.disabled=false;sendBtn.style.opacity="1";sendBtn.style.cursor="pointer";});});
db.ref('messages').on('value',snap=>renderMessages(snap.val()));

/* --- GIF COOLDOWN --- */
const gifStatus = document.createElement("p");
gifStatus.id = "gifStatus";
gifStatus.style = `
  color: #aaa;
  font-size: 12px;
  text-align: center;
  margin-top: 10px;
  background-color: #333;
  border: 1px solid #555;
  border-radius: 6px;
  padding: 6px;
`;

// make sure .sideBar exists before appending
const sideBar = document.querySelector(".sideBar");
if (sideBar) {
  sideBar.appendChild(gifStatus);
} else {
  // fallback: append to body if sidebar not found
  document.body.appendChild(gifStatus);
}

/**
 * Starts local cooldown timer for GIFs.
 * Disables all clickable GIFs temporarily.
 */
function startLocalGifCooldown(seconds, onDone) {
  let timeLeft = seconds;
  gifStatus.textContent = `You can send another GIF in ${timeLeft}s`;

  const imgs = document.querySelectorAll("#locked img");
  imgs.forEach(img => {
    img.style.filter = "grayscale(100%)";
    img.style.pointerEvents = "none";
    img.style.opacity = "0.6";
  });

  const timer = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) {
      clearInterval(timer);
      imgs.forEach(img => {
        img.style.filter = "none";
        img.style.pointerEvents = "auto";
        img.style.opacity = "1";
      });
      gifStatus.textContent = "You can send GIFs freely.";
      if (typeof onDone === "function") onDone(); // ‚úÖ Re-enable click
    } else {
      gifStatus.textContent = `You can send another GIF in ${timeLeft}s`;
    }
  }, 1000);
}

/**
 * Makes all GIFs in a container clickable for sending.
 */
function enableGifClick(container) {
  const gifs = container.querySelectorAll("img");
  gifs.forEach(img => {
    img.style.cursor = "pointer";
    img.replaceWith(img.cloneNode(true)); // remove old event listeners
  });

  const refreshedGifs = container.querySelectorAll("img");
  refreshedGifs.forEach(img => {
    let localBlocked = false;

    img.addEventListener("click", async () => {
      if (localBlocked) return;

      const userId = currentUserId;
      if (!userId) return alert("User not found.");

      const cooldownTime = shortCooldownUsers.includes(userId) ? 3000 : 25000;
      localBlocked = true;

      // Start cooldown + automatically reset when done
      startLocalGifCooldown(cooldownTime / 1000, () => {
        localBlocked = false;
      });

      const userRef = db.ref(`gifCooldowns/${userId}`);
      const now = Date.now();

      try {
        const snap = await userRef.once("value");
        const data = snap.val();

        if (data && data.expires > now) {
          const wait = Math.ceil((data.expires - now) / 1000);
          alert(`‚è≥ Please wait ${wait}s before sending another GIF.`);
          localBlocked = false;
          return;
        }

        // ‚úÖ Send GIF message
        await db.ref("messages").push({
          username: userId,
          gifUrl: img.src,
          timestamp: now
        });

        // ‚úÖ Set server cooldown timestamp
        await userRef.set({ expires: now + cooldownTime });

      } catch (err) {
        alert("‚ùå Error sending GIF: " + err.message);
        localBlocked = false;
      }
    });
  });
}

/**
 * Removes expired cooldown entries from Firebase
 */
async function restoreGifCooldowns() {
  const snap = await db.ref("gifCooldowns").once("value");
  const data = snap.val() || {};
  const now = Date.now();

  Object.keys(data).forEach(uid => {
    if (data[uid].expires < now) db.ref(`gifCooldowns/${uid}`).remove();
  });
}

// Initialize
enableGifClick(document.getElementById("locked"));
restoreGifCooldowns();


/* -------------------- INIT -------------------- */
createAdminPanel();
createOnlinePanel();
</script>
<!-- Ban Watcher-->
<script>
// ‚úÖ Check for active ban after login but before other features
if (currentUserId) {
  db.ref(`bans/${currentUserId}`).once("value").then(snap => {
    const banData = snap.val();
    if (banData && banData.expires > Date.now()) {
      const expires = new Date(banData.expires).toLocaleString();
      alert(`‚õî You are banned until ${expires}. You cannot use PingPals.`);
      window.location.href = "./index.html"; // redirect banned user
    } else if (banData) {
      // Ban expired, remove entry
      db.ref(`bans/${currentUserId}`).remove();
    }
  }).catch(err => console.error("Error checking ban:", err));
}
</script>

<!-- -------------------- IMAGE UPLOAD -------------------- -->
<script>
// Show upload section only to PremiumOG/Admin
const uploadSection = document.getElementById("uploadSection");
if (currentUser.role === "PremiumOG" || currentUser.role === "Admin") {
  uploadSection.style.display = "block";
}

const imageInput = document.getElementById("imageUpload");
const imagePreview = document.getElementById("imagePreview");

// Preview selected image
imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (!file) return;
  if (file.size > 2 * 1024 * 1024) { // 2MB max
    alert("‚ö†Ô∏è File too large! Max 2MB.");
    imageInput.value = "";
    imagePreview.innerHTML = "";
    return;
  }
  const reader = new FileReader();
  reader.onload = e => {
    imagePreview.innerHTML = `<img src="${e.target.result}" style="max-width:200px; border-radius:8px;" />`;
  };
  reader.readAsDataURL(file);
});

// Upload image to Firebase as a message
document.getElementById("sendImageBtn").addEventListener("click", async () => {
  const file = imageInput.files[0];
  if (!file) return alert("Select an image first!");

  const reader = new FileReader();
  reader.onload = async e => {
    const imageData = e.target.result;
    try {
      const newMsg = {
        username: currentUserId,
        gifUrl: imageData, // reuse gifUrl field
        timestamp: Date.now()
      };
      db.ref("messages").push(newMsg);
      // Reset input
      imageInput.value = "";
      imagePreview.innerHTML = "";
    } catch (err) {
      alert("‚ùå Upload failed: " + err.message);
    }
  };
  reader.readAsDataURL(file);
});



if (!currentUser || (currentUser.role !== "PremiumOG" && currentUser.role !== "Admin")) {
  const msgInput = document.getElementById("msgInput");

  // stop flexbox from controlling it
  msgInput.style.flex = "none";
  msgInput.style.minWidth = "0";
  msgInput.style.flexBasis = "auto";

  // force custom width
  msgInput.style.setProperty("width", "65vw", "important");
}

</script>
<script src="./script/gifbox.js" defer></script>
</body>
</html>
