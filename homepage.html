<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PIXELCHAT</title>
  <link rel="stylesheet" href="./chat.css" />
</head>






<body>
<script>
  // Redirect if not logged in properly
  if (sessionStorage.getItem("loginAsk") !== "true") {
    // Optional: alert before redirect
    alert("Access denied. Redirecting to login...");
    window.location.href = "./index.html";
  }
</script>


<div class="locked">
    <img src="./gifs/67-67-kid.gif">
    <img src="./gifs/67.gif">
    <img src="./gifs/anime-mad.gif">
    <img src="./gifs/anime-manga.gif">
    <img src="./gifs/chill.gif">
    <img src="./gifs/cute.gif">
    <img src="./gifs/dave-and-bambi-distruption.gif">
    <img src="./gifs/fnf-dave.gif">
    <img src="./gifs/gojo.gif">
    <img src="./gifs/goon-tuah.gif">
    <img src="./gifs/kakashi.gif">
    <img src="./gifs/kis.gif">
    <img src="./gifs/mad.gif">
    <img src="./gifs/maga-girl-guitar.gif">
    <img src="./gifs/mango-mango-mango.gif">
    <img src="./gifs/mommy-anime.gif">
    <img src="./gifs/shiideraii.gif">
    <img src="./gifs/shrek.gif">
</div>


<div class="locked3">
    <div class="locked2">
    <img src="./gifs/rightGifs/7tv-emotes.gif">
    <img src="./gifs/rightGifs/angry.gif">
    <img src="./gifs/rightGifs/black-guy-maid-vibe-black-maid-dance.gif">
    <img src="./gifs/rightGifs/bosnov-67.gif">
    <img src="./gifs/rightGifs/emoji.gif">
    <img src="./gifs/rightGifs/enojado.gif">
    <img src="./gifs/rightGifs/gooner-goon.gif">
    <img src="./gifs/rightGifs/hasbulla-hasbik.gif">
    <img src="./gifs/rightGifs/kermit-the-frog.gif">
    <img src="./gifs/rightGifs/oh-no-oh-my-god.gif">
    <img src="./gifs/rightGifs/oop-take.gif">
    <img src="./gifs/rightGifs/patrick-bateman-smile.gif">
    <img src="./gifs/rightGifs/reallycooked.gif">
    <img src="./gifs/rightGifs/sigmasungjinwoo-mewing.gif">
    <img src="./gifs/rightGifs/solid-snake-salute.gif">
    <img src="./gifs/rightGifs/solo-leveling-sololeveling.gif">
    <img src="./gifs/rightGifs/thofinn.gif">
    <img src="./gifs/rightGifs/thorfinn.gif">
    <img src="./gifs/rightGifs/twitch-twitch-emote.gif">
    <img src="./gifs/rightGifs/vinland-saga-thorfinn.gif">
    <img src="./gifs/rightGifs/what-twitch.gif">
</div>
</div>




  <div class="MainArea">

    <div class="Header2"><p>PIXELCHAT BY MUZAFAR</p></div>
    <div class="MainActionContainer">
      <!-- Username is taken from sessionStorage set on sign-in -->

  <div id="signedInAs" class="GroupNormalMargin"></div>

        <form id="msgForm">
         <div style="display:flex; gap:8px; align-items:center;">
            <input id="msgInput" type="text" placeholder="Type a message" style="flex:1;" />
            <input type="submit" value="Send" />
         </div>
        </form>

      <div id="messages" class="GroupNormalMargin">
        <p>Loading messages...</p>
      </div>
    </div>

  </div>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBGPFSP0e0oYqKqvJHLB5eGlX9mJ8aU09s",
  authDomain: "test-da143.firebaseapp.com",
  databaseURL: "https://test-da143-default-rtdb.firebaseio.com",
  projectId: "test-da143",
  storageBucket: "test-da143.firebasestorage.app",
  messagingSenderId: "58366480447",
  appId: "1:58366480447:web:f3dd12850f09952b49688a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Block unauthorized access
if (!sessionStorage.getItem("loginAsk")) {
  alert("Access denied. Redirecting...");
  window.location.href = "index.html";
}

const msgForm = document.getElementById("msgForm");
const msgInput = document.getElementById("msgInput");
const messagesDiv = document.getElementById("messages");

const currentUser = localStorage.getItem("username") || sessionStorage.getItem("username");
document.getElementById("signedInAs").textContent = "Signed in as: " + currentUser;

// Render messages
db.ref("messages").limitToLast(50).on("child_added", snap => {
  const msg = snap.val();
  const div = document.createElement("div");
  div.innerHTML = `<strong>${msg.username}:</strong> ${msg.text}<br><small>${new Date(msg.timestamp).toLocaleTimeString()}</small>`;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

// Send message
msgForm.addEventListener("submit", e => {
  e.preventDefault();
  const text = msgInput.value.trim();
  if (!text) return;
  db.ref("messages").push({ username: currentUser, text, timestamp: Date.now() });
  msgInput.value = "";
});

// Auto logout after 20 min
setTimeout(() => {
  sessionStorage.clear();
  localStorage.clear();
  alert("Session expired. Please log in again.");
  window.location.href = "index.html";
}, 20 * 60 * 1000);
</script>


  </div>
</body>
</html>